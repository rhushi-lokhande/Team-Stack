/// <reference path="../../server.d.ts" />
'use strict';
var express = require('express'), passport = require('passport'), auth = require('../auth.service');
var router = express.Router();
router.post('/', function (req, res, next) {
    passport.authenticate('local', function (err, user, info) {
        var error = err || info;
        if (error)
            return res.status(401).json(error);
        if (!user)
            return res.status(401).json({ msg: 'login failed' });
        var token = auth.signToken(user._id);
        res.json({ token: token, user: user });
    })(req, res, next);
});
module.exports = router;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvbG9jYWwvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMENBQTBDO0FBQzFDLFlBQVksQ0FBQztBQUViLElBQUksT0FBTyxHQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFDN0IsUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFDOUIsSUFBSSxHQUFPLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBRTFDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUU5QixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxVQUFTLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUNwQyxRQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxVQUFTLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSTtRQUNuRCxJQUFJLEtBQUssR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDO1FBQ3hCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBRXpELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyIsImZpbGUiOiJhdXRoL2xvY2FsL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3NlcnZlci5kLnRzXCIgLz5cbid1c2Ugc3RyaWN0JztcblxudmFyIGV4cHJlc3MgID0gcmVxdWlyZSgnZXhwcmVzcycpLFxuICAgIHBhc3Nwb3J0ID0gcmVxdWlyZSgncGFzc3BvcnQnKSxcbiAgICBhdXRoICAgICA9IHJlcXVpcmUoJy4uL2F1dGguc2VydmljZScpO1xuXG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxucm91dGVyLnBvc3QoJy8nLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIHBhc3Nwb3J0LmF1dGhlbnRpY2F0ZSgnbG9jYWwnLCBmdW5jdGlvbihlcnIsIHVzZXIsIGluZm8pIHtcbiAgICAgICAgdmFyIGVycm9yID0gZXJyIHx8IGluZm87XG4gICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbihlcnJvcik7XG4gICAgICAgIGlmICghdXNlcilcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1zZzogJ2xvZ2luIGZhaWxlZCcgfSk7XG5cbiAgICAgICAgdmFyIHRva2VuID0gYXV0aC5zaWduVG9rZW4odXNlci5faWQpO1xuICAgICAgICByZXMuanNvbih7IHRva2VuOiB0b2tlbiwgdXNlcjogdXNlciB9KTtcbiAgICB9KShyZXEsIHJlcywgbmV4dCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
