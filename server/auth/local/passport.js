/// <reference path="../../server.d.ts" />
'use strict';
var passport = require('passport'), LocalStrategy = require('passport-local').Strategy;
exports.setup = function (User) {
    passport.use(new LocalStrategy({
        usernameField: 'email',
        passwordField: 'password'
    }, function (email, password, done) {
        User.findOne({
            email: email
        }, function (err, user) {
            if (err)
                return done(err);
            if (!user)
                return done(null, false, { msg: 'email not found' });
            if (!user.authenticate(password))
                return done(null, false, { msg: 'incorrect password' });
            return done(null, user);
        });
    }));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvbG9jYWwvcGFzc3BvcnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMENBQTBDO0FBQzFDLFlBQVksQ0FBQztBQUViLElBQUksUUFBUSxHQUFRLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFDbkMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQztBQUV2RCxPQUFPLENBQUMsS0FBSyxHQUFHLFVBQVMsSUFBSTtJQUN6QixRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksYUFBYSxDQUFDO1FBQ3ZCLGFBQWEsRUFBRSxPQUFPO1FBQ3RCLGFBQWEsRUFBRSxVQUFVO0tBQzVCLEVBQ0QsVUFBUyxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUk7UUFDMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULEtBQUssRUFBRSxLQUFLO1NBQ2YsRUFBRSxVQUFTLEdBQUcsRUFBRSxJQUFJO1lBQ2pCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQztnQkFDSixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXJCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUM7WUFFekQsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO1lBRTVELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUNBLENBQUMsQ0FBQztBQUNYLENBQUMsQ0FBQyIsImZpbGUiOiJhdXRoL2xvY2FsL3Bhc3Nwb3J0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL3NlcnZlci5kLnRzXCIgLz5cbid1c2Ugc3RyaWN0JztcblxudmFyIHBhc3Nwb3J0ICAgICAgPSByZXF1aXJlKCdwYXNzcG9ydCcpLFxuICAgIExvY2FsU3RyYXRlZ3kgPSByZXF1aXJlKCdwYXNzcG9ydC1sb2NhbCcpLlN0cmF0ZWd5O1xuXG5leHBvcnRzLnNldHVwID0gZnVuY3Rpb24oVXNlcikge1xuICAgIHBhc3Nwb3J0LnVzZShuZXcgTG9jYWxTdHJhdGVneSh7XG4gICAgICAgICAgICB1c2VybmFtZUZpZWxkOiAnZW1haWwnLFxuICAgICAgICAgICAgcGFzc3dvcmRGaWVsZDogJ3Bhc3N3b3JkJ1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbihlbWFpbCwgcGFzc3dvcmQsIGRvbmUpIHtcbiAgICAgICAgICAgIFVzZXIuZmluZE9uZSh7XG4gICAgICAgICAgICAgICAgZW1haWw6IGVtYWlsXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIsIHVzZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9uZShlcnIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9uZShudWxsLCBmYWxzZSwgeyBtc2c6ICdlbWFpbCBub3QgZm91bmQnIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyLmF1dGhlbnRpY2F0ZShwYXNzd29yZCkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkb25lKG51bGwsIGZhbHNlLCB7IG1zZzogJ2luY29ycmVjdCBwYXNzd29yZCcgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZG9uZShudWxsLCB1c2VyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgICkpO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
