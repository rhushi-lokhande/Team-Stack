/// <reference path="../../app.d.ts" />
'use strict';
var RabbitMQ_TestApp;
(function (RabbitMQ_TestApp) {
    var Services;
    (function (Services) {
        var Auth;
        (function (Auth) {
            var AuthService = (function () {
                function AuthService($localStorage, $q, $http, $window, $state, CONFIG) {
                    var _this = this;
                    this.$localStorage = $localStorage;
                    this.$q = $q;
                    this.$http = $http;
                    this.$window = $window;
                    this.$state = $state;
                    this.CONFIG = CONFIG;
                    this._ready = $q.defer();
                    if ($localStorage.token) {
                        $http.get(CONFIG.API_SERVER + '/api/users/me')
                            .then(function (res) { return _this._user = res.data; })
                            .finally(function () { return _this._ready.resolve(true); });
                    }
                    else
                        this._ready.resolve(true);
                }
                AuthService.prototype.ready = function () {
                    return this._ready.promise;
                };
                AuthService.prototype.signup = function (user) {
                    var _this = this;
                    var deferred = this.$q.defer();
                    this.$http.post(this.CONFIG.API_SERVER + '/api/users', user)
                        .then(function (res) {
                        _this._user = res.data.user;
                        _this.$localStorage.token = res.data.token;
                        deferred.resolve();
                    })
                        .catch(function (err) { return deferred.reject(err.data); });
                    return deferred.promise;
                };
                AuthService.prototype.login = function (user) {
                    var _this = this;
                    var deferred = this.$q.defer();
                    this.$http.post(this.CONFIG.API_SERVER + '/auth/local', user)
                        .then(function (res) {
                        _this._user = res.data.user;
                        _this.$localStorage.token = res.data.token;
                        deferred.resolve();
                    })
                        .catch(function (err) { return deferred.reject(err.data); });
                    return deferred.promise;
                };
                AuthService.prototype.facebookLogin = function () {
                    var _this = this;
                    var deferred = this.$q.defer();
                    var url = this.CONFIG.API_SERVER + '/auth/facebook', width = 1000, height = 650, top = (window.outerHeight - height) / 2, left = (window.outerWidth - width) / 2, popup = this.$window.open(url, 'facebook_login', 'width=' + width + ',height=' + height + ',scrollbars=0,top=' + top + ',left=' + left + ',titlebar=no,toolbar=no,location=no,directories=no,menubar=no');
                    window.addEventListener('message', function (e) {
                        var message = e.data;
                        if (message.status === 'success') {
                            popup.close();
                            _this._user = message.user;
                            _this.$localStorage.token = message.token;
                            _this.$state.reload();
                            deferred.resolve();
                        }
                        else if (message.status === 'fail') {
                            popup.close();
                            delete _this._user;
                            delete _this.$localStorage.token;
                            _this.$state.reload();
                            deferred.reject();
                        }
                    });
                    return deferred.promise;
                };
                AuthService.prototype.logout = function () {
                    delete this.$localStorage.token;
                    delete this._user;
                };
                AuthService.prototype.isLogged = function () {
                    return typeof this._user !== 'undefined';
                };
                AuthService.prototype.getUser = function () {
                    return this._user;
                };
                AuthService.$inject = ['$localStorage', '$q', '$http', '$window', '$state', 'CONFIG'];
                return AuthService;
            })();
            angular.module('rabbitMqTest').service('Auth', AuthService);
        })(Auth = Services.Auth || (Services.Auth = {}));
    })(Services = RabbitMQ_TestApp.Services || (RabbitMQ_TestApp.Services = {}));
})(RabbitMQ_TestApp || (RabbitMQ_TestApp = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC9zZXJ2aWNlcy9hdXRoL2F1dGgudHMiXSwibmFtZXMiOlsiUmFiYml0TVFfVGVzdEFwcCIsIlJhYmJpdE1RX1Rlc3RBcHAuU2VydmljZXMiLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGgiLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGguQXV0aFNlcnZpY2UiLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGguQXV0aFNlcnZpY2UuY29uc3RydWN0b3IiLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGguQXV0aFNlcnZpY2UucmVhZHkiLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGguQXV0aFNlcnZpY2Uuc2lnbnVwIiwiUmFiYml0TVFfVGVzdEFwcC5TZXJ2aWNlcy5BdXRoLkF1dGhTZXJ2aWNlLmxvZ2luIiwiUmFiYml0TVFfVGVzdEFwcC5TZXJ2aWNlcy5BdXRoLkF1dGhTZXJ2aWNlLmZhY2Vib29rTG9naW4iLCJSYWJiaXRNUV9UZXN0QXBwLlNlcnZpY2VzLkF1dGguQXV0aFNlcnZpY2UubG9nb3V0IiwiUmFiYml0TVFfVGVzdEFwcC5TZXJ2aWNlcy5BdXRoLkF1dGhTZXJ2aWNlLmlzTG9nZ2VkIiwiUmFiYml0TVFfVGVzdEFwcC5TZXJ2aWNlcy5BdXRoLkF1dGhTZXJ2aWNlLmdldFVzZXIiXSwibWFwcGluZ3MiOiJBQUFBLHVDQUF1QztBQUN2QyxZQUFZLENBQUM7QUFFYixJQUFPLGdCQUFnQixDQWtIdEI7QUFsSEQsV0FBTyxnQkFBZ0I7SUFBQ0EsSUFBQUEsUUFBUUEsQ0FrSC9CQTtJQWxIdUJBLFdBQUFBLFFBQVFBO1FBQUNDLElBQUFBLElBQUlBLENBa0hwQ0E7UUFsSGdDQSxXQUFBQSxJQUFJQSxFQUFDQSxDQUFDQTtZQVNuQ0M7Z0JBT0lDLHFCQUNZQSxhQUFhQSxFQUNiQSxFQUFnQkEsRUFDaEJBLEtBQXNCQSxFQUN0QkEsT0FBMEJBLEVBQzFCQSxNQUEyQkEsRUFDM0JBLE1BQWtC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RE4sOEJBQVFBLEdBQVJBO29CQUNJTyxNQUFNQSxDQUFDQSxPQUFPQSxJQUFJQSxDQUFDQSxLQUFLQSxLQUFLQSxXQUFXQSxDQUFDQTtnQkFDN0NBLENBQUNBO2dCQUVEUCw2QkFBT0EsR0FBUEE7b0JBQ0lRLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBO2dCQUN0QkEsQ0FBQ0E7Z0JBaEdNUixtQkFBT0EsR0FBR0EsQ0FBQ0EsZUFBZUEsRUFBRUEsSUFBSUEsRUFBRUEsT0FBT0EsRUFBRUEsU0FBU0EsRUFBRUEsUUFBUUEsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7Z0JBaUdyRkEsa0JBQUNBO1lBQURBLENBdEdBRCxBQXNHQ0MsSUFBQUQ7WUFFREEsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFDaEVBLENBQUNBLEVBbEhnQ0QsSUFBSUEsR0FBSkEsYUFBSUEsS0FBSkEsYUFBSUEsUUFrSHBDQTtJQUFEQSxDQUFDQSxFQWxIdUJELFFBQVFBLEdBQVJBLHlCQUFRQSxLQUFSQSx5QkFBUUEsUUFrSC9CQTtBQUFEQSxDQUFDQSxFQWxITSxnQkFBZ0IsS0FBaEIsZ0JBQWdCLFFBa0h0QiIsImZpbGUiOiJjbGllbnQvc2VydmljZXMvYXV0aC9hdXRoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2FwcC5kLnRzXCIgLz5cbid1c2Ugc3RyaWN0JztcblxubW9kdWxlIFJhYmJpdE1RX1Rlc3RBcHAuU2VydmljZXMuQXV0aCB7XG5cbiAgICBpbnRlcmZhY2UgSUF1dGhDYWxsYmFjayBleHRlbmRzIG5nLklIdHRwUHJvbWlzZUNhbGxiYWNrQXJnPHt9PiB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXI6IHt9O1xuICAgICAgICAgICAgdG9rZW46IHN0cmluZztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNsYXNzIEF1dGhTZXJ2aWNlIGltcGxlbWVudHMgSUF1dGhTZXJ2aWNlIHtcblxuICAgICAgICBwcml2YXRlIF91c2VyO1xuICAgICAgICBwcml2YXRlIF9yZWFkeTogbmcuSURlZmVycmVkPGJvb2xlYW4+O1xuXG4gICAgICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckbG9jYWxTdG9yYWdlJywgJyRxJywgJyRodHRwJywgJyR3aW5kb3cnLCAnJHN0YXRlJywgJ0NPTkZJRyddO1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICAgICAgcHJpdmF0ZSAkbG9jYWxTdG9yYWdlLFxuICAgICAgICAgICAgcHJpdmF0ZSAkcTogbmcuSVFTZXJ2aWNlLFxuICAgICAgICAgICAgcHJpdmF0ZSAkaHR0cDogbmcuSUh0dHBTZXJ2aWNlLFxuICAgICAgICAgICAgcHJpdmF0ZSAkd2luZG93OiBuZy5JV2luZG93U2VydmljZSxcbiAgICAgICAgICAgIHByaXZhdGUgJHN0YXRlOiBuZy51aS5JU3RhdGVTZXJ2aWNlLFxuICAgICAgICAgICAgcHJpdmF0ZSBDT05GSUc6IElBcHBDb25maWcpIHtcblxuICAgICAgICAgICAgdGhpcy5fcmVhZHkgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICBpZiAoJGxvY2FsU3RvcmFnZS50b2tlbikge1xuICAgICAgICAgICAgICAgICRodHRwLmdldChDT05GSUcuQVBJX1NFUlZFUiArICcvYXBpL3VzZXJzL21lJylcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzID0+IHRoaXMuX3VzZXIgPSByZXMuZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gdGhpcy5fcmVhZHkucmVzb2x2ZSh0cnVlKSk7XG4gICAgICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWFkeS5yZXNvbHZlKHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVhZHkoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZHkucHJvbWlzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNpZ251cCh1c2VyKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHRoaXMuJGh0dHAucG9zdCh0aGlzLkNPTkZJRy5BUElfU0VSVkVSICsgJy9hcGkvdXNlcnMnLCB1c2VyKVxuICAgICAgICAgICAgICAgIC50aGVuKChyZXM6IElBdXRoQ2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXNlciA9IHJlcy5kYXRhLnVzZXI7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvY2FsU3RvcmFnZS50b2tlbiA9IHJlcy5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyID0+IGRlZmVycmVkLnJlamVjdChlcnIuZGF0YSkpO1xuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dpbih1c2VyKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSB0aGlzLiRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHRoaXMuJGh0dHAucG9zdCh0aGlzLkNPTkZJRy5BUElfU0VSVkVSICsgJy9hdXRoL2xvY2FsJywgdXNlcilcbiAgICAgICAgICAgICAgICAudGhlbigocmVzOiBJQXV0aENhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3VzZXIgPSByZXMuZGF0YS51c2VyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2NhbFN0b3JhZ2UudG9rZW4gPSByZXMuZGF0YS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBkZWZlcnJlZC5yZWplY3QoZXJyLmRhdGEpKTtcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZmFjZWJvb2tMb2dpbigpIHtcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHRoaXMuJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuQ09ORklHLkFQSV9TRVJWRVIgKyAnL2F1dGgvZmFjZWJvb2snLFxuICAgICAgICAgICAgICAgIHdpZHRoID0gMTAwMCxcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSA2NTAsXG4gICAgICAgICAgICAgICAgdG9wID0gKHdpbmRvdy5vdXRlckhlaWdodCAtIGhlaWdodCkgLyAyLFxuICAgICAgICAgICAgICAgIGxlZnQgPSAod2luZG93Lm91dGVyV2lkdGggLSB3aWR0aCkgLyAyLFxuICAgICAgICAgICAgICAgIHBvcHVwID0gdGhpcy4kd2luZG93Lm9wZW4odXJsLCAnZmFjZWJvb2tfbG9naW4nLCAnd2lkdGg9JyArIHdpZHRoICsgJyxoZWlnaHQ9JyArIGhlaWdodCArICcsc2Nyb2xsYmFycz0wLHRvcD0nICsgdG9wICsgJyxsZWZ0PScgKyBsZWZ0ICsgJyx0aXRsZWJhcj1ubyx0b29sYmFyPW5vLGxvY2F0aW9uPW5vLGRpcmVjdG9yaWVzPW5vLG1lbnViYXI9bm8nKTtcblxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBlID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGUuZGF0YTtcblxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwLmNsb3NlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXNlciA9IG1lc3NhZ2UudXNlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9jYWxTdG9yYWdlLnRva2VuID0gbWVzc2FnZS50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RhdGUucmVsb2FkKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLnN0YXR1cyA9PT0gJ2ZhaWwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVwLmNsb3NlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3VzZXI7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLiRsb2NhbFN0b3JhZ2UudG9rZW47XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHN0YXRlLnJlbG9hZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dvdXQoKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy4kbG9jYWxTdG9yYWdlLnRva2VuO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX3VzZXI7XG4gICAgICAgIH1cblxuICAgICAgICBpc0xvZ2dlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdGhpcy5fdXNlciAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgICAgIH1cblxuICAgICAgICBnZXRVc2VyKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgncmFiYml0TXFUZXN0Jykuc2VydmljZSgnQXV0aCcsIEF1dGhTZXJ2aWNlKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
